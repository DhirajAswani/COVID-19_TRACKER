<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>CoVis-19-Tracker</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />

    <!-- <link rel="stylesheet" href="package/dist/Chart.min.css"> -->
    <script
  src="https://code.jquery.com/jquery-3.5.0.min.js"
  integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ="
  crossorigin="anonymous"></script>
    <!-- <script src="package/dist/Chart.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/countup@1.8.2/dist/countUp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha256-R4pqcOYV8lt7snxMQO/HSbVCFRPMdrhAFMH+vr9giYI=" crossorigin="anonymous"></script>
    <!-- <script src="countUp.js-master/dist/countUp.js"></script> -->
    

  </head>
  <body>
    
    <!--[if lt IE 7]>
      <p class="browsehappy">
        You are using an <strong>outdated</strong> browser. Please
        <a href="#">upgrade your browser</a> to improve your experience.
      </p>
    <![endif]-->

   
    <div class="bs-example">
        
            <a href="index.html" class="navbar-brand ml-2 ">
                <img src="https://images.unsplash.com/photo-1583324113626-70df0f4deaab?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjEyMDd9" height="30" alt="COVID-19">
                COVID-19 TRACKER </a>

            
            <!-- <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button> -->
    
           
        
    </div>
    <div class="text-center mt-4"> 
      <form name="demoform">
        <select style="background-color: lightgrey;" class="btn mb-4" name="country" onchange="getCountries()" id="countries">
          <option>Select_Country</option>
        </select>
      </form>

      
      <h2 id = "india" class="mt-2 mb-2" style="display: none;"> <span id="output"></span></h2>
      <h2><span id="country_name"  style="margin-top: 15px;"></span>  </h2>
    </div> 
   
   

    <div class="container">
      <div class="row">
        <div
          class="card text-white bg-secondary mb-4 col-sm-4 mr-4 md-col-4 mx-auto mt-5 rounded "
          style="max-width: 18rem;"
        >
          <div class="card-header"><h1>Confirmed</h1></div>
          <div class="card-body">
            
            <p class="card-text">
                <h3><span id="confirmed_cases"></span></h3>
                <h3><span id="last_update"></span></h3>
                <h4>Number of Active Cases of COVID-19</h4>
            </p>
          </div>
        </div>

        <div
        class="card text-white bg-primary mb-4 col-sm-4 mr-4 md-col-4 mx-auto mt-5 rounded"
        style="max-width: 18rem;"
        >
        <div class="card-header"><h1>Active</h1></div>
        <div class="card-body">
          
          <p class="card-text">
              <h3><span id="active_cases"></span></h3>
              <h3><span id="last_update3"></span></h3>
              <h4>Number of Active Cases from COVID-19</h4>
          </p>
        </div>
      </div>

        <div
          class="card text-white bg-success mb-4 col-sm-4 mr-4 md-col-4 mx-auto mt-5 rounded"
          style="max-width: 18rem;"
        >
          <div class="card-header"><h1>Recovered</h1></div>
          <div class="card-body">
            
            <p class="card-text">
                <h3><span id="recovered_cases"></span></h3>
                <h3><span id="last_update1"></span></h3>
                <h4>Number of Recoveries from COVID-19</h4>
            </p>
          </div>
        </div>

        <div
          class="card text-white bg-danger mb-4 col-sm-4 md-col-4 mx-auto mt-5 rounded"
          style="max-width: 18rem;"
         >
          <div class="card-header"><h1>Deaths</h1></div>
          <div class="card-body">
            
            <p class="card-text">
                <h3><span id="deaths"></span></h3>
                <h3><span id="last_update2"></span></h3>
                <h4>Number of Deaths from COVID-19</h4>
            </p>
          </div>
        </div style="position: relative;
        margin: auto;
        height: 80vh;
        width: 80vw;">

        
          <canvas id="myChart"  style="border: 1px dotted black;" class="col-sm-4 md-col-4"></canvas>

        
      </div>
    </div>


    <div class="bs-example">
        <nav class="navbar navbar-expand-md navbar-light bg-light mt-4">
            <h6>Created By <a href="https://dhirajaswani.github.io/portfolio_website/">Dhiraj Aswani</a></h6>

            
        </nav>
    </div>


    
    <!-- <div
          class="card text-white bg-success mb-4 col-sm-4 mr-4 md-col-4 mx-auto mt-5 rounded"
          style="max-width: 18rem;"
        >
          <div class="card-header"><h1>Recovered</h1></div>
          <div class="card-body">
            
            <p class="card-text">
                <h3><span id="recovered_cases"></span></h3>
                <h3><span id="last_update1"></span></h3>
                <h4>Number of Recoveries from COVID-19</h4>
            </p>
          </div>
        </div> -->

  

    <script>
      const api_url = "https://covid19.mathdro.id/api/countries/India";

      const api_countries = "https://covid19.mathdro.id/api/countries";

      


      // function changeCountryName()
      // {
      //   document.getElementById("india2").style.display = "none";
      //   document.getElementById("india").style.display = "block";
      // }

      async function drawChart(confirmed, Infected, deaths)
      {
        var ctx = document.getElementById('myChart').getContext('2d');
      var myChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
              labels: ['Active', 'Recovered', 'Deaths'],
              datasets: [{
                  label: 'Confirmed',
                  data: [confirmed,Infected,deaths],
                  backgroundColor: [
                      '#0275d8','#5cb85c','#d9534f'
                  ],
                  // borderColor: [
                  //     'rgba(255, 99, 132, 1)',
                  //     'rgba(54, 162, 235, 1)',
                  //     'rgba(255, 206, 86, 1)',
                  //     'rgba(75, 192, 192, 1)',
                  //     'rgba(153, 102, 255, 1)',
                  //     'rgba(255, 159, 64, 1)'
                  // ],
                  borderWidth: 1
              }],
              
          },
          
          options: {
              scales: {
                  yAxes: [{
                      ticks: {
                          beginAtZero: true
                      }
                  }]
              }
          }
      });
      }
      
      async function getCountries() {
        const response = await fetch(api_countries);
        const countries = await response.json();
        
        // let arr = countries[0];
        // console.log(countries);
        // console.log(countries.countries[15].name);
        var country_names = new Array();

        for (let i = 0; i < 185; i++) {
          //   console.log(countries.countries[i].name);
          var temp = await countries.countries[i].name;
          country_names.push(temp);
        }

        // console.log(country_names);

        //only country name
        // console.log(countries.countries[0].name);
        // ******************************************************************************
        // Working code

        var select = document.getElementById("countries");
        for (var i = 0; i < country_names.length; i++) {
          var option = document.createElement("OPTION");
          txt = document.createTextNode(country_names[i]);
          option.appendChild(txt);
          option.setAttribute("value", country_names[i]);
          select.insertBefore(option, select.lastChild);
        }
        // ****************************************************************************************
        // selectElement = document.querySelector("#countries");

        // output = selectElement.value;

        // document.querySelector(".output").textContent = output;

        // var e = document.getElementById("countries");
        // var strUser = e.options[e.selectedIndex].text;
        // console.log(strUser);
        // *****************************************************************************************
        // Working Code
        var theselect = demoform.country;
        var output = document.getElementById("output");
        output.innerHTML = theselect[theselect.selectedIndex].text;
        var country_name = theselect[theselect.selectedIndex].text;
        // console.log(country_name);

        // const response = await fetch(api_url);
        // const data = await response.json();
        // console.log(data);

        if(country_name == "Select_Country")
        {
          getData("India")
        }
        else
        {
          getData(country_name);
        }

        

        // **********************************************************************************

        
      }
      async function getData(country_name) {
        const response = await fetch("https://covid19.mathdro.id/api/countries/"+country_name);
        const data = await response.json();
        var dropdown_country_name = document.getElementById("country_name");
        dropdown_country_name.innerHTML = country_name;
        // console.log(data);
        // console.log("Inside getData ");
        // console.log(country_name);
        const modifiedData = {
          confirmed: data.confirmed,
          recovered: data.recovered,
          deaths: data.deaths,
          lastUpdate: data.lastUpdate,
        };
        // console.log(modifiedData.confirmed.value);
        // console.log(modifiedData.deaths.value);
        // console.log(modifiedData.recovered.value);
        // console.log(modifiedData.lastUpdate);
        document.getElementById("confirmed_cases").innerHTML =
          modifiedData.confirmed.value;
          var options = {
              useeasing : true,
              useGrouping: true,
              separator: ','
          }
        var c = new CountUp("confirmed_cases", 0, modifiedData.confirmed.value, 0, 2.5, options);
        c.start();
        document.getElementById("recovered_cases").innerHTML =
          modifiedData.recovered.value;
        var c1 = new CountUp("recovered_cases", 0, modifiedData.recovered.value, 0, 2.5, options);
        c1.start();
        document.getElementById("deaths").innerHTML = modifiedData.deaths.value;

        var c2 = new CountUp("deaths", 0, modifiedData.deaths.value, 0, 2.5, options);
        c2.start();
        document.getElementById("last_update").innerHTML = new Date(
          modifiedData.lastUpdate
        ).toDateString();
        document.getElementById("last_update1").innerHTML = new Date(
          modifiedData.lastUpdate
        ).toDateString();
        document.getElementById("last_update2").innerHTML = new Date(
          modifiedData.lastUpdate
        ).toDateString();

        var a1 = modifiedData.confirmed.value;
        var a2 =  modifiedData.recovered.value;
        var a3 = modifiedData.deaths.value;
        var a4 = a1- (a2 + a3);
        document.getElementById("active_cases").innerHTML = a4;
        var c3 = new CountUp("active_cases", 0, a4, 0, 2.5, options);
        c3.start();
        document.getElementById("last_update3").innerHTML = new Date(
          modifiedData.lastUpdate
        ).toDateString();

        console.log(a4,a2,a3);

        drawChart(a4,a2, a3)
      }

      
    getCountries();
    //  getData(country_name);
    </script>

    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>

    
  </body>
</html>
